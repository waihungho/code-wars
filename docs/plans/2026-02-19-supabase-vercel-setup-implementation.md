# Supabase + Vercel Setup Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Set up Supabase for persistent data storage and Vercel for test (preview) and production deployments.

**Architecture:** Single Supabase project (free tier) with Supabase CLI for migrations. Single Vercel project with environment variable overrides — preview deployments use Solana devnet, production uses mainnet-beta. All environments share the same Supabase database.

**Tech Stack:** Supabase CLI, Vercel CLI (already installed), Next.js 16, existing `@supabase/supabase-js` client.

---

## Important Notes

- The existing `supabase/schema.sql` has a **stale `language_enum`** with only 8 languages. The TypeScript code (`src/lib/types.ts`) defines 28 languages. The migration must use all 28.
- The Supabase CLI is **not installed** — needs `brew install supabase/tap/supabase`.
- The Vercel CLI **is installed** at `/opt/homebrew/bin/vercel`.
- The `.gitignore` already ignores `.env*` and `.vercel/`.
- No application code changes are needed — `src/lib/supabase.ts` and `src/lib/db.ts` already handle env-based Supabase connection.

---

### Task 1: Install Supabase CLI

**Files:**
- None (system-level install)

**Step 1: Install Supabase CLI via Homebrew**

Run:
```bash
brew install supabase/tap/supabase
```

Expected: Installation completes successfully.

**Step 2: Verify installation**

Run:
```bash
supabase --version
```

Expected: Prints version number (e.g., `1.x.x`).

---

### Task 2: Initialize Supabase CLI in project

**Files:**
- Create: `supabase/config.toml` (generated by CLI)
- Create: `supabase/migrations/` directory (generated by CLI)
- Create: `supabase/seed.sql` (empty, generated by CLI)

**Step 1: Initialize Supabase in the project root**

Run from project root:
```bash
cd /Users/vfire/wisers/side/card-game-programming-lang
supabase init
```

If it warns that `supabase/` already exists (because of `schema.sql`), that's fine — it will create the missing files/dirs alongside it.

Expected: Creates `supabase/config.toml` and `supabase/migrations/` directory.

**Step 2: Verify the structure**

Run:
```bash
ls -la supabase/
```

Expected: Should show `config.toml`, `migrations/` dir, `schema.sql` (existing), and possibly `seed.sql`.

**Step 3: Commit the Supabase CLI scaffolding**

Run:
```bash
git add supabase/config.toml
git commit -m "chore: initialize Supabase CLI config"
```

---

### Task 3: Create the initial migration file

This is the most critical task. The existing `supabase/schema.sql` has a stale `language_enum` with only 8 languages. We need to create a corrected migration with all 28 languages.

**Files:**
- Create: `supabase/migrations/20260219000000_initial_schema.sql`
- Keep: `supabase/schema.sql` (as reference, unchanged)

**Step 1: Create the migration file**

Create `supabase/migrations/20260219000000_initial_schema.sql` with the full corrected schema. The key difference from `supabase/schema.sql` is the `language_enum` must include all 28 languages:

```sql
-- =========================================================================
-- Code Wars: Initial Schema
-- =========================================================================

-- Players table
CREATE TABLE players (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  wallet_address TEXT UNIQUE NOT NULL,
  free_pulls_remaining INTEGER DEFAULT 3 NOT NULL,
  last_pull_reset TIMESTAMPTZ DEFAULT now() NOT NULL,
  xp INTEGER DEFAULT 0 NOT NULL,
  materials INTEGER DEFAULT 0 NOT NULL,
  daily_battles INTEGER DEFAULT 0 NOT NULL,
  created_at TIMESTAMPTZ DEFAULT now() NOT NULL
);

-- Language enum — all 28 languages
CREATE TYPE language_enum AS ENUM (
  'Assembly', 'C', 'CPlusPlus', 'CSharp', 'Clojure', 'COBOL', 'Dart', 'Delphi',
  'Elixir', 'Erlang', 'Go', 'Haskell', 'Java', 'JavaScript', 'Kotlin', 'Lua',
  'MATLAB', 'Pascal', 'Perl', 'PHP', 'Python', 'R', 'Ruby', 'Rust',
  'Scala', 'Solidity', 'SQL', 'Swift'
);

CREATE TYPE rarity_enum AS ENUM (
  'Common', 'Uncommon', 'Rare', 'Legendary', 'Mythic'
);

-- Cards table
CREATE TABLE cards (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  player_id UUID REFERENCES players(id) ON DELETE CASCADE NOT NULL,
  language language_enum NOT NULL,
  rarity rarity_enum NOT NULL,
  speed INTEGER NOT NULL,
  security INTEGER NOT NULL,
  ecosystem INTEGER NOT NULL,
  scalability INTEGER NOT NULL,
  dev_exp INTEGER NOT NULL,
  nft_mint_address TEXT,
  created_at TIMESTAMPTZ DEFAULT now() NOT NULL
);

-- Battle logs
CREATE TYPE battle_result_enum AS ENUM ('win', 'lose', 'draw');

CREATE TABLE battle_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  player_id UUID REFERENCES players(id) ON DELETE CASCADE NOT NULL,
  player_card_id UUID REFERENCES cards(id) ON DELETE SET NULL,
  ai_language language_enum NOT NULL,
  ai_stats JSONB NOT NULL,
  dimensions_picked TEXT[] NOT NULL,
  result battle_result_enum NOT NULL,
  xp_earned INTEGER DEFAULT 0 NOT NULL,
  created_at TIMESTAMPTZ DEFAULT now() NOT NULL
);

-- Core indexes
CREATE INDEX idx_cards_player_id ON cards(player_id);
CREATE INDEX idx_battle_logs_player_id ON battle_logs(player_id);
CREATE INDEX idx_battle_logs_result ON battle_logs(result);
CREATE INDEX idx_players_wallet ON players(wallet_address);

-- =========================================================================
-- Row Level Security
-- =========================================================================
ALTER TABLE players ENABLE ROW LEVEL SECURITY;
ALTER TABLE cards ENABLE ROW LEVEL SECURITY;
ALTER TABLE battle_logs ENABLE ROW LEVEL SECURITY;

-- Players: read/write own data
CREATE POLICY "Players can view own profile"
  ON players FOR SELECT
  USING (wallet_address = current_setting('app.wallet_address', true));

CREATE POLICY "Players can update own profile"
  ON players FOR UPDATE
  USING (wallet_address = current_setting('app.wallet_address', true));

CREATE POLICY "Players can insert own profile"
  ON players FOR INSERT
  WITH CHECK (true);

-- Cards: read/write own cards
CREATE POLICY "Players can view own cards"
  ON cards FOR SELECT
  USING (player_id IN (
    SELECT id FROM players WHERE wallet_address = current_setting('app.wallet_address', true)
  ));

CREATE POLICY "Players can insert own cards"
  ON cards FOR INSERT
  WITH CHECK (player_id IN (
    SELECT id FROM players WHERE wallet_address = current_setting('app.wallet_address', true)
  ));

CREATE POLICY "Players can delete own cards"
  ON cards FOR DELETE
  USING (player_id IN (
    SELECT id FROM players WHERE wallet_address = current_setting('app.wallet_address', true)
  ));

-- Battle logs: read/insert own
CREATE POLICY "Players can view own battles"
  ON battle_logs FOR SELECT
  USING (player_id IN (
    SELECT id FROM players WHERE wallet_address = current_setting('app.wallet_address', true)
  ));

CREATE POLICY "Players can insert own battles"
  ON battle_logs FOR INSERT
  WITH CHECK (player_id IN (
    SELECT id FROM players WHERE wallet_address = current_setting('app.wallet_address', true)
  ));

-- Leaderboard: public read access
CREATE POLICY "Anyone can view players for leaderboard"
  ON players FOR SELECT
  USING (true);

CREATE POLICY "Anyone can view battle_logs for leaderboard"
  ON battle_logs FOR SELECT
  USING (true);

-- =========================================================================
-- Leaderboard RPC functions
-- =========================================================================
CREATE OR REPLACE FUNCTION leaderboard_by_wins(lim INTEGER DEFAULT 20)
RETURNS TABLE(wallet_address TEXT, total_wins BIGINT) AS $$
  SELECT p.wallet_address, COUNT(*) as total_wins
  FROM battle_logs bl
  JOIN players p ON p.id = bl.player_id
  WHERE bl.result = 'win'
  GROUP BY p.wallet_address
  ORDER BY total_wins DESC
  LIMIT lim;
$$ LANGUAGE sql STABLE;

CREATE OR REPLACE FUNCTION leaderboard_by_win_rate(lim INTEGER DEFAULT 20)
RETURNS TABLE(wallet_address TEXT, win_rate NUMERIC, total_battles BIGINT) AS $$
  SELECT
    p.wallet_address,
    ROUND(COUNT(*) FILTER (WHERE bl.result = 'win')::NUMERIC / COUNT(*)::NUMERIC, 3) as win_rate,
    COUNT(*) as total_battles
  FROM battle_logs bl
  JOIN players p ON p.id = bl.player_id
  GROUP BY p.wallet_address
  HAVING COUNT(*) >= 10
  ORDER BY win_rate DESC
  LIMIT lim;
$$ LANGUAGE sql STABLE;

CREATE OR REPLACE FUNCTION leaderboard_by_strongest_card(lim INTEGER DEFAULT 20)
RETURNS TABLE(wallet_address TEXT, language language_enum, total_stats BIGINT) AS $$
  SELECT
    p.wallet_address,
    c.language,
    (c.speed + c.security + c.ecosystem + c.scalability + c.dev_exp)::BIGINT as total_stats
  FROM cards c
  JOIN players p ON p.id = c.player_id
  ORDER BY total_stats DESC
  LIMIT lim;
$$ LANGUAGE sql STABLE;

-- =========================================================================
-- Equipment System
-- =========================================================================
CREATE TYPE slot_type_enum AS ENUM ('stat_boost', 'ability_enhancement', 'utility', 'ai_core', 'consumable');

CREATE TABLE equipment_items (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  slot_type slot_type_enum NOT NULL,
  effect_type TEXT NOT NULL,
  effect_value JSONB NOT NULL,
  sol_price DECIMAL(10,4) NOT NULL,
  description TEXT NOT NULL
);

CREATE TABLE player_inventory (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  player_id UUID REFERENCES players(id) ON DELETE CASCADE NOT NULL,
  item_id TEXT REFERENCES equipment_items(id) NOT NULL,
  purchased_at TIMESTAMPTZ DEFAULT now() NOT NULL
);

CREATE TABLE card_equipment (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  card_id UUID REFERENCES cards(id) ON DELETE CASCADE NOT NULL,
  inventory_id UUID REFERENCES player_inventory(id) ON DELETE CASCADE NOT NULL,
  slot_type slot_type_enum NOT NULL,
  equipped_at TIMESTAMPTZ DEFAULT now() NOT NULL,
  UNIQUE(card_id, slot_type)
);

CREATE TABLE sol_transactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  player_id UUID REFERENCES players(id) ON DELETE CASCADE NOT NULL,
  tx_signature TEXT UNIQUE NOT NULL,
  sol_amount DECIMAL(10,4) NOT NULL,
  item_id TEXT REFERENCES equipment_items(id) NOT NULL,
  status TEXT DEFAULT 'pending' NOT NULL CHECK (status IN ('pending', 'confirmed', 'failed')),
  created_at TIMESTAMPTZ DEFAULT now() NOT NULL
);

-- Equipment indexes
CREATE INDEX idx_inventory_player_id ON player_inventory(player_id);
CREATE INDEX idx_card_equipment_card_id ON card_equipment(card_id);
CREATE INDEX idx_sol_tx_player_id ON sol_transactions(player_id);
CREATE INDEX idx_sol_tx_signature ON sol_transactions(tx_signature);

-- Equipment RLS
ALTER TABLE equipment_items ENABLE ROW LEVEL SECURITY;
ALTER TABLE player_inventory ENABLE ROW LEVEL SECURITY;
ALTER TABLE card_equipment ENABLE ROW LEVEL SECURITY;
ALTER TABLE sol_transactions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Equipment catalog is public" ON equipment_items FOR SELECT USING (true);

CREATE POLICY "Players view own inventory" ON player_inventory FOR SELECT
  USING (player_id IN (SELECT id FROM players WHERE wallet_address = current_setting('app.wallet_address', true)));
CREATE POLICY "Players insert own inventory" ON player_inventory FOR INSERT
  WITH CHECK (player_id IN (SELECT id FROM players WHERE wallet_address = current_setting('app.wallet_address', true)));
CREATE POLICY "Players delete own inventory" ON player_inventory FOR DELETE
  USING (player_id IN (SELECT id FROM players WHERE wallet_address = current_setting('app.wallet_address', true)));

CREATE POLICY "Players view own equipment" ON card_equipment FOR SELECT
  USING (card_id IN (SELECT c.id FROM cards c JOIN players p ON c.player_id = p.id WHERE p.wallet_address = current_setting('app.wallet_address', true)));
CREATE POLICY "Players insert own equipment" ON card_equipment FOR INSERT
  WITH CHECK (card_id IN (SELECT c.id FROM cards c JOIN players p ON c.player_id = p.id WHERE p.wallet_address = current_setting('app.wallet_address', true)));
CREATE POLICY "Players delete own equipment" ON card_equipment FOR DELETE
  USING (card_id IN (SELECT c.id FROM cards c JOIN players p ON c.player_id = p.id WHERE p.wallet_address = current_setting('app.wallet_address', true)));

CREATE POLICY "Players view own transactions" ON sol_transactions FOR SELECT
  USING (player_id IN (SELECT id FROM players WHERE wallet_address = current_setting('app.wallet_address', true)));
CREATE POLICY "Players insert own transactions" ON sol_transactions FOR INSERT
  WITH CHECK (player_id IN (SELECT id FROM players WHERE wallet_address = current_setting('app.wallet_address', true)));
```

**Step 2: Verify the migration file exists**

Run:
```bash
ls supabase/migrations/
```

Expected: `20260219000000_initial_schema.sql`

**Step 3: Commit the migration**

Run:
```bash
git add supabase/migrations/20260219000000_initial_schema.sql
git commit -m "feat: add initial Supabase migration with all 28 languages"
```

---

### Task 4: Create the seed data file

**Files:**
- Create: `supabase/seed.sql`

**Step 1: Create the seed file**

Create `supabase/seed.sql` with INSERT statements for all 25 equipment catalog items. Values come from `src/lib/constants.ts:345-370` (`EQUIPMENT_CATALOG`):

```sql
-- Seed equipment catalog (25 items)
-- Source of truth: src/lib/constants.ts EQUIPMENT_CATALOG

INSERT INTO equipment_items (id, name, slot_type, effect_type, effect_value, sol_price, description) VALUES
-- Consumables
('summon-3',         'Extra Summon (x3)',       'consumable',           'add_pulls',         '{"amount": 3}',                                                    0.02,  '+3 gacha pulls'),
('summon-10',        'Extra Summon (x10)',      'consumable',           'add_pulls',         '{"amount": 10}',                                                   0.05,  '+10 gacha pulls'),
('summon-50',        'Extra Summon (x50)',      'consumable',           'add_pulls',         '{"amount": 50}',                                                   0.20,  '+50 gacha pulls'),
('battle-10',        'Battle Pass (x10)',       'consumable',           'add_battles',       '{"amount": 10}',                                                   0.01,  '+10 daily battles'),
('battle-20',        'Battle Pass (x20)',       'consumable',           'add_battles',       '{"amount": 20}',                                                   0.02,  '+20 daily battles'),
('battle-unlimited', 'Unlimited Battle Pass',   'consumable',           'unlimited_battles', '{"hours": 24}',                                                    1.00,  'Unlimited battles for 24h'),
-- Stat Boost
('stat-chip-1',      'Stat Chip I',             'stat_boost',           'stat_percent',      '{"percent": 10}',                                                  0.05,  '+10% to one stat'),
('stat-chip-2',      'Stat Chip II',            'stat_boost',           'stat_percent',      '{"percent": 25}',                                                  0.20,  '+25% to one stat'),
('stat-chip-3',      'Stat Chip III',           'stat_boost',           'stat_percent',      '{"percent": 50}',                                                  0.50,  '+50% to one stat'),
('omni-chip',        'Omni Chip',               'stat_boost',           'all_stats_percent', '{"percent": 15}',                                                  1.00,  '+15% to ALL stats'),
-- Ability Enhancement
('trigger-amp-1',    'Trigger Amplifier I',     'ability_enhancement',  'trigger_chance',    '{"chance": 0.45}',                                                 0.10,  'Ability trigger 30% → 45%'),
('trigger-amp-2',    'Trigger Amplifier II',    'ability_enhancement',  'trigger_chance',    '{"chance": 0.60}',                                                 0.35,  'Ability trigger 30% → 60%'),
('passive-boost',    'Passive Booster',         'ability_enhancement',  'passive_multiply',  '{"multiplier": 2}',                                                0.15,  'Passive ability bonus doubled'),
('overcharge',       'Ability Overcharge',      'ability_enhancement',  'overcharge',        '{"passiveMultiplier": 2, "chance": 0.50}',                          0.75,  'Passive doubled + trigger 50%'),
-- Utility
('dim-scout',        'Dimension Scout',         'utility',              'preview_dimension', '{"count": 1}',                                                     0.05,  'Preview 1 of 3 battle dimensions'),
('xp-magnet-1',      'XP Magnet I',             'utility',              'xp_multiplier',     '{"multiplier": 1.5}',                                              0.08,  '+50% XP from battles'),
('xp-magnet-2',      'XP Magnet II',            'utility',              'xp_multiplier',     '{"multiplier": 2.0}',                                              0.30,  '+100% XP from battles'),
('lucky-charm',      'Lucky Charm',             'utility',              'rarity_boost',      '{"bonus": 0.05}',                                                  0.50,  '+5% higher rarity chance'),
-- AI Core
('ai-core',          'AI Core',                 'ai_core',              'ai_core',           '{"allStatsPercent": 50, "triggerChance": 0.70, "passiveMultiplier": 3, "xpMultiplier": 2.0}', 10.00, '+50% ALL stats, trigger 70%, passive x3, +100% XP')
ON CONFLICT (id) DO NOTHING;
```

**Step 2: Commit the seed file**

Run:
```bash
git add supabase/seed.sql
git commit -m "feat: add equipment catalog seed data"
```

---

### Task 5: Fix the stale language_enum in schema.sql

The original `supabase/schema.sql` only has 8 languages. Update it to match the migration (28 languages) so it remains useful as a reference.

**Files:**
- Modify: `supabase/schema.sql:14-16`

**Step 1: Update the language_enum**

In `supabase/schema.sql`, replace line 14-16:
```sql
CREATE TYPE language_enum AS ENUM (
  'Assembly', 'C', 'Rust', 'Java', 'Go', 'JavaScript', 'Python', 'Solidity'
);
```

With:
```sql
CREATE TYPE language_enum AS ENUM (
  'Assembly', 'C', 'CPlusPlus', 'CSharp', 'Clojure', 'COBOL', 'Dart', 'Delphi',
  'Elixir', 'Erlang', 'Go', 'Haskell', 'Java', 'JavaScript', 'Kotlin', 'Lua',
  'MATLAB', 'Pascal', 'Perl', 'PHP', 'Python', 'R', 'Ruby', 'Rust',
  'Scala', 'Solidity', 'SQL', 'Swift'
);
```

**Step 2: Commit**

Run:
```bash
git add supabase/schema.sql
git commit -m "fix: update schema.sql language_enum to include all 28 languages"
```

---

### Task 6: Update .env.local.example with documentation

**Files:**
- Modify: `.env.local.example`

**Step 1: Update the env example file**

Replace the entire contents of `.env.local.example` with:

```bash
# =============================================================================
# Supabase — get these from your Supabase project dashboard > Settings > API
# =============================================================================
NEXT_PUBLIC_SUPABASE_URL=https://your-project-ref.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here

# =============================================================================
# Solana — network and RPC endpoint
# Development/Preview: use devnet
# Production: use mainnet-beta (set via Vercel env overrides)
# =============================================================================
NEXT_PUBLIC_SOLANA_RPC_URL=https://api.devnet.solana.com
NEXT_PUBLIC_SOLANA_NETWORK=devnet
```

**Step 2: Commit**

Run:
```bash
git add .env.local.example
git commit -m "docs: update .env.local.example with Supabase and Solana config docs"
```

---

### Task 7: Create Supabase project (manual step)

This is a manual step — the engineer must do this in the browser.

**Step 1: Create the Supabase project**

1. Go to https://supabase.com/dashboard
2. Click "New Project"
3. Name: `code-wars` (or your preferred name)
4. Database password: generate a strong one and save it
5. Region: pick the closest to your target users
6. Plan: Free tier
7. Click "Create new project" and wait for it to provision (~2 minutes)

**Step 2: Copy the project credentials**

1. Go to project dashboard > Settings > API
2. Copy the **Project URL** (e.g., `https://abc123.supabase.co`)
3. Copy the **anon public** key
4. Save both — you'll need them for the next step

**Step 3: Create .env.local with real credentials**

Create `.env.local` in the project root (this file is git-ignored):

```bash
NEXT_PUBLIC_SUPABASE_URL=https://your-actual-project-ref.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-actual-anon-key
NEXT_PUBLIC_SOLANA_RPC_URL=https://api.devnet.solana.com
NEXT_PUBLIC_SOLANA_NETWORK=devnet
```

---

### Task 8: Link Supabase CLI and push the migration

**Files:**
- None (CLI operations)

**Step 1: Link the CLI to the remote project**

Run:
```bash
supabase link --project-ref YOUR_PROJECT_REF
```

The project ref is the subdomain from your Supabase URL (e.g., if URL is `https://abc123.supabase.co`, the ref is `abc123`).

You'll be prompted for the database password you set in Task 7.

Expected: "Finished supabase link."

**Step 2: Push the migration to the remote database**

Run:
```bash
supabase db push
```

Expected: Migration `20260219000000_initial_schema.sql` is applied. Output should show the migration being applied successfully.

**Step 3: Run the seed data on the remote database**

Run:
```bash
supabase db execute --file supabase/seed.sql
```

Expected: 25 equipment items inserted (or "ON CONFLICT DO NOTHING" if already present).

**Step 4: Verify the tables exist**

Run:
```bash
supabase db execute --command "SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' ORDER BY table_name;"
```

Expected: Should list: `battle_logs`, `card_equipment`, `cards`, `equipment_items`, `player_inventory`, `players`, `sol_transactions`

**Step 5: Verify equipment items were seeded**

Run:
```bash
supabase db execute --command "SELECT COUNT(*) FROM equipment_items;"
```

Expected: `25`

---

### Task 9: Verify the app works with Supabase

**Files:**
- None (testing)

**Step 1: Run the existing test suite**

Run:
```bash
npm run test:run
```

Expected: Tests pass (same as before — they use in-memory mode). The 2 gacha edge-case failures are pre-existing and unrelated.

**Step 2: Start the dev server and test manually**

Run:
```bash
npm run dev
```

Expected: App starts at `http://localhost:3000`. With `.env.local` configured, the app should connect to Supabase instead of falling back to in-memory mode.

**Step 3: Verify Supabase connection**

1. Open the app in browser
2. Connect a Phantom wallet
3. The game should create a player record in Supabase
4. Check the Supabase dashboard > Table Editor > `players` table to confirm the record exists

**Step 4: Commit any changes (if needed)**

If no code changes were needed, no commit. If anything needed fixing, commit the fix.

---

### Task 10: Set up Vercel project

**Files:**
- None (CLI operations)

**Step 1: Link the project to Vercel**

Run from project root:
```bash
vercel link
```

Follow the prompts:
- Set up and develop: Yes
- Which scope: your Vercel account
- Link to existing project: No (create new)
- Project name: `code-wars` (or your preferred name)
- Directory: `./`

Expected: Creates `.vercel/` directory (git-ignored) and links the project.

**Step 2: Verify the link**

Run:
```bash
vercel whoami
```

Expected: Shows your Vercel username.

---

### Task 11: Configure Vercel environment variables

**Files:**
- None (Vercel dashboard/CLI)

**Step 1: Set Supabase variables (all environments)**

Run:
```bash
echo "YOUR_SUPABASE_URL" | vercel env add NEXT_PUBLIC_SUPABASE_URL production preview development
echo "YOUR_ANON_KEY" | vercel env add NEXT_PUBLIC_SUPABASE_ANON_KEY production preview development
```

Replace `YOUR_SUPABASE_URL` and `YOUR_ANON_KEY` with actual values from Task 7.

**Step 2: Set Solana devnet for preview and development**

Run:
```bash
echo "https://api.devnet.solana.com" | vercel env add NEXT_PUBLIC_SOLANA_RPC_URL preview development
echo "devnet" | vercel env add NEXT_PUBLIC_SOLANA_NETWORK preview development
```

**Step 3: Set Solana mainnet for production**

Run:
```bash
echo "https://api.mainnet-beta.solana.com" | vercel env add NEXT_PUBLIC_SOLANA_RPC_URL production
echo "mainnet-beta" | vercel env add NEXT_PUBLIC_SOLANA_NETWORK production
```

**Step 4: Verify all environment variables**

Run:
```bash
vercel env ls
```

Expected: Shows 4 variables across the appropriate scopes:
- `NEXT_PUBLIC_SUPABASE_URL` — Production, Preview, Development
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` — Production, Preview, Development
- `NEXT_PUBLIC_SOLANA_RPC_URL` — Production (mainnet), Preview+Development (devnet)
- `NEXT_PUBLIC_SOLANA_NETWORK` — Production (mainnet-beta), Preview+Development (devnet)

---

### Task 12: Deploy to Vercel (preview)

**Files:**
- None (deployment)

**Step 1: Do a preview deployment to test**

Run:
```bash
vercel
```

(Without `--prod` flag, this creates a preview deployment.)

Expected: Build succeeds, outputs a preview URL (e.g., `https://code-wars-xyz.vercel.app`).

**Step 2: Verify the preview deployment**

1. Open the preview URL in browser
2. Connect Phantom wallet
3. Verify the app works (gacha, battle, equipment pages load)
4. Check that it's using Solana **devnet** (wallet should show devnet network)

---

### Task 13: Deploy to Vercel (production)

**Files:**
- None (deployment)

**Step 1: Deploy to production**

Run:
```bash
vercel --prod
```

Expected: Build succeeds, outputs the production URL.

**Step 2: Verify the production deployment**

1. Open the production URL in browser
2. Connect Phantom wallet
3. Verify the app works
4. Confirm it's using Solana **mainnet-beta** (wallet should show mainnet)
5. Check Supabase dashboard to confirm player records are created

---

### Task 14: Update .gitignore for Supabase (if needed)

**Files:**
- Possibly modify: `.gitignore`

**Step 1: Check if Supabase adds any files that should be ignored**

After `supabase init` and `supabase link`, check for any new untracked files:

Run:
```bash
git status
```

If there are files like `.supabase/` or similar that shouldn't be committed, add them to `.gitignore`:

```
# supabase
.supabase/
```

**Step 2: Commit if changes were made**

Run:
```bash
git add .gitignore
git commit -m "chore: add Supabase temp files to gitignore"
```

---

### Task 15: Final verification and commit

**Step 1: Run full test suite**

Run:
```bash
npm run test:run
```

Expected: Same results as before (no regressions).

**Step 2: Run build**

Run:
```bash
npm run build
```

Expected: Build succeeds with no errors.

**Step 3: Check git status is clean**

Run:
```bash
git status
```

Expected: Working tree clean (all changes committed).

**Step 4: Review what was committed**

Run:
```bash
git log --oneline -10
```

Expected: Shows the new commits for this setup work.
